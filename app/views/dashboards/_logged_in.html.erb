<div id="content-sidebar" class="col-xs-12 col-sm-4">

  <h1>Mes contacts</h1>
  <div class="text-center loading">
    <%= image_tag "loading.gif", class: "loading", width: "64", height:"64" %>
    <p><small>Récupération des données...</small></p>
  </div>
  <div id="people"></div>



</div>

<div id="content-details" class="col-xs-12 col-sm-8">
  <div id="dashboard">
    <h3>Statut de mon comité</h3>
    <div class="row">
      <div class="col-xs-4 text-center">
        <i class="glyphicon glyphicon-user" style="font-size: 50px;"></i>
        <h5><%= @children.count %></h5>
        <p>Membres dans mon comité</p>
      </div>
      <div class="col-xs-4 text-center">
        <i class="glyphicon glyphicon-ok" style="font-size: 50px;"></i>
        <h5><%= @children.count %></h5>
        <p>Membres contactés</p>
      </div>
      <div class="col-xs-4 text-center">
        <i class="glyphicon glyphicon-flash" style="font-size: 50px;"></i>
        <h5>10</h5>
        <p>Actions de terrain réalisées</p>
      </div>
    </div>
    <h3>Mes objectifs</h3>
    <h5>Objectif n°1 : Recruter 15 membres</h5>
    <% total_membres = [@children.count, 15].min %>
    <div class="progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="<%= total_membres %>"
           aria-valuemin="0" aria-valuemax="15" style="width: <%= (total_membres / 15.0) * 100 %>%;">
        <% if total_membres >= 15 %>
            Objectif de 15 membres atteint, bravo !
        <% else %>
            Encore <%= 15 - total_membres %> membres à recruter !
        <% end %>
      </div>
    </div>
  </div>
  <div id="person-loading" class="text-center loading hidden">
    <%= image_tag "loading.gif", class: "loading", width: "64", height:"64" %>
    <p><small>Récupération des données...</small></p>
  </div>
  <div id="person" class="hidden">
  </div>
</div>

<script type="text/javascript">
  $(function() {

    window.loadingGif = new Image();
    window.loadingGif.src = 'images/loading.gif';

    window.params = {
      email: "<%= current_user.email %>",
      baseUrl: "https://mail.google.com/mail/?authuser=<%= current_user.email %>&view=cm&fs=1&to=",
      semaphore: {
        updates: false
      }
    };

    window.functionsAjxCrm = {
      getHome: function() {
        $("#dashboard").removeClass("hidden");
        $("#person").addClass("hidden");
        $("#people").find("li").removeClass("selected");
      }
    }

    window.generateEmailLink = function(dest_mail) {
      return window.params["baseUrl"]+dest_mail;
    };

    $(function() {
      $("#button-email-comite-contact").attr("href", window.generateEmailLink($("#button-email-comite-contact").attr("href")));
      $("#button-email-referent-contact").attr("href", window.generateEmailLink($("#button-email-referent-contact").attr("href")));
      $("#button-email-support-contact").attr("href", window.generateEmailLink($("#button-email-support-contact").attr("href")));

      $("#button-home").on("click", function() {
        window.functionsAjxCrm.getHome();
        return false;
      });
    });

    window.peopleCollection = new StaticFiles.Collections.PeopleCollection();

    window.peopleCollection.fetch({
      success: function (peopleCollection, response) {
        window.peopleView = new StaticFiles.Views.People.IndexView({el: '#people', collection: peopleCollection});
        window.peopleView.render();
        window.peopleCollection.fetchFromNationBuilder();
      }
    });

  });
</script>